---
title: "Rustã§ã‚¨ãƒ©ãƒ¼ã‚’æ¡ã‚Šã¤ã¶ã™"
emoji: "ğŸ¤›"
type: "tech"
topics:
  - "rust"
published: true
published_at: "2024-02-25 14:06"
---


ã‚¨ãƒ©ãƒ¼ã¯æ¡ã‚Šã¤ã¶ã™ã®ã¯è‰¯ããªã„ã¨æ€ã†(å°å­¦ç”Ÿä¸¦ã¿ã®æ€è€ƒ)ã®ã§ã€ã“ã‚“ãªã‚‚ã‚“å€‹äººç”¨é€”ã§æ›¸ãæ¨ã¦ã‚‹æ™‚ã«ã—ã‹ä½¿ã‚ãªã„ã¨æ€ã„ã¾ã™ã‚ˆã€‚
æ›¸ãæ¨ã¦ã‚‹æ™‚ã«ã€å¤±æ•—ã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã‘ã©`unwrap()`ã ã¨å¼·åˆ¶çµ‚äº†ã—ã¦ãã‚‹ã‹ã‚‰å›°ã‚‹ï¼ï¼ã‹ã‚‰ãã®å¯¾å‡¦

# `?`æ¼”ç®—å­ã‚’ä½¿ã†

Resultã‹Optionã‚’è¿”ã™é–¢æ•°ã«ã¯`?`æ¼”ç®—å­ãŒä½¿ãˆã¾ã™ã€‚`?`æ¼”ç®—å­ã®å¯¾è±¡ãŒ`Some`ã ã£ãŸã‚Š`Ok`ã ã£ãŸã‚Šã—ãŸå ´åˆã¯ä¸­èº«ã‚’å–ã‚Šå‡ºã—ã¦ãã‚Œã¦ã€`Err`ã ã£ãŸã‚Š`None`ã ã£ãŸã‚Šã—ãŸå ´åˆã¯æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã—ã¦ãã‚Œã‚‹ã‚‚ã®ã§ã™ã­ã€‚ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒã ã‚‹ã„å ´åˆã¯ã“ã„ã¤ã‚’ä½¿ã£ã¦ãŠã‘ã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã­

```rust
fn returns_result() -> Result<u32, Box<dyn std::error::Error>> {
    let mut string = String::new();
    std::io::stdin().read_line(&mut string)?;
    let number = string.parse::<u32>()?;

    Ok(number)
}

fn returns_option() -> Option<u32> {
    let mut v = vec![1, 2, 3, 4, 5].into_iter();

    let first = v.next()?;
    let second = v.next()?;
    let third = v.next();
    third
}
```

# Optionã‚’ä½¿ã†
`Result`å‹ã‚’è¿”ã—ã¦ãã‚‹é–¢æ•°ã‚‚`.ok()`ã‚’ä½¿ã£ã¦å…¨éƒ¨`Option`ã«ã—ã¾ã™ã€‚ã“ã‚Œã§ã‚¨ãƒ©ãƒ¼æƒ…å ±ãŒçš†ç„¡ã«ãªã‚Šã¾ã™ã­ï¼(^v^)/
```rust
fn aiueo() -> Option<()> {
    let mut v = vec![1, 2, 3, 4, 5].into_iter();
    // `Option`ã‚’è¿”ã™ã®ã§å˜ã«`?`ã‚’ä»˜ã‘ã‚‹ã ã‘ã§ã„ã„
    let first = v.next()?;
    let second = v.next()?;

    let mut string = String::new();
    // `Result`å‹ã‚’è¿”ã—ã¦ãã‚‹ã®ã§`.ok()`ã§`Option`å‹ã«å¤‰ãˆã¦`?`
    std::io::stdin().read_line(&mut string).ok()?;
    let number = string.parse::<u32>().ok()?;

    Some(())
}
```

å¤±æ•—ã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å‡¦ç†ã«ã¯[`.collect::<Option<V>>()`](https://doc.rust-lang.org/std/iter/trait.FromIterator.html#impl-FromIterator%3COption%3CA%3E%3E-for-Option%3CV%3E)ãŒä½¿ãˆã‚‹ã®ã§æ´»ç”¨ã—ã¾ã—ã‚‡ã†
(ä¸‹ã®ã¯HTTPã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚’`HashMap`ã«å¤‰æ›ã™ã‚‹ä¾‹(â€»æ›¸ãæ¨ã¦))

```rust
fn parse_headers(request_headers: Vec<String>) -> Option<HashMap<String, String>> {
    request_headers
        .into_iter()
        .map(|header| {
            let mut pair = header.split(": ").map(|x| x.to_string());
            match (pair.next(), pair.next()) {
                (Some(key), Some(value)) => Some((key, value)),
                _ => None,
            }
        })
        .collect::<Option<HashMap<String, String>>>()
}
```

ã§ã€ã“ã†ã¿ã‚“ãªãŒã¿ã‚“ãªOptionã‚’è¿”ã—ã¦ä¼æ’­ã—ã¦ã„ã£ã¦ã€æœ€çµ‚çš„ã«mainãã‚‰ã„ã®ä¸Šå±¤ã§æ¡ã‚Šã¤ã¶ã—ã¾ã™ã€‚`match`ã§ã‚‚`unwrap_or_else`ã§ã‚‚ãªã‚“ã§ã‚‚å¥½ããªã‚ˆã†ã«
ã‚¨ãƒ©ãƒ¼ãŒã‚ã£ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãŒã‚ã£ãŸã“ã¨ãã‚‰ã„ã¯æƒ…å ±ã¨ã—ã¦å‡ºã—ã¦ã‚‚ã„ã„ã‹ã‚‚ã§ã™ã­

```rust
match aiueo() {
    None => eprintln!("ã‚¨ãƒ©ãƒ¼æœ‰ã‚Š"),
    Some(_) => (),
};
```

# Resultã‚’ä½¿ã†

æ¡ã‚Šã¤ã¶ã—ã¦ã‚‹ã›ã„ã§ã©ã“ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã‹ã‚‚åˆ†ã‹ã‚‰ã­ãˆã˜ã‚ƒã­ãˆã‹ï¼ã£ã¦æ€ã†ã®ã§ã‚ã‚Œã°Optionã‚’`.ok_or()`ã§`Result`ã«å¤‰æ›ã™ã‚‹ã®ã‚‚ã‚ã‚Šã§ã—ã‚‡ã†
ã€Œã©ã“ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã‹ã€ãã‚‰ã„ã®æ°—æŒã¡ç¨‹åº¦ã®ã‚¨ãƒ©ãƒ¼æƒ…å ±ã§

```rust
fn aiueo_result() -> Result<(), Box<dyn std::error::Error>> {
    let mut v = vec![1, 2, 3, 4, 5].into_iter();
    // `.ok_or()`ã§Resultã«å¤‰ãˆã‚‹
    let first = v.next().ok_or("vã®1å€‹ç›®ãŒç„¡ã„")?;
    let second = v.next().ok_or("vã®2å€‹ç›®ãŒãªã„")?;

    let mut string = String::new();
    std::io::stdin().read_line(&mut string)?;
    let number = string.parse::<u32>()?;

    Ok(())
}

fn main() {
    match aiueo_result() {
        Err(e) => println!("ã‚¨ãƒ©ãƒ¼æœ‰ã‚Š:{}", e),
        Ok(()) => (),
    }
}
```

# ã¾ã¨ã‚

ãƒã‚¸ã§æ›¸ãæ¨ã¦ç”¨é€”ä»¥å¤–ã«ä½¿ã‚ãªã„ã¨æ€ã†